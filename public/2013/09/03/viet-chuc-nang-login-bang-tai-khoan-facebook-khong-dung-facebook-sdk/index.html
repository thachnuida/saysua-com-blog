<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Viết chức năng login bằng tài khoản facebook không dùng Facebook SDK | Saysua Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Bài viết hơi dài, mong bạn đọc nhẫn nại!
Hiện nay hẳn các bạn sẽ bắt gặp rất nhiều trang web có chức năng sử dụng tài khoản facebook để đăng nhập, điều đó thuận tiện ở chỗ người dùng không phải mất cô">
<meta property="og:type" content="article">
<meta property="og:title" content="Viết chức năng login bằng tài khoản facebook không dùng Facebook SDK">
<meta property="og:url" content="http://saysua.com/2013/09/03/viet-chuc-nang-login-bang-tai-khoan-facebook-khong-dung-facebook-sdk/index.html">
<meta property="og:site_name" content="Saysua Blog">
<meta property="og:description" content="Bài viết hơi dài, mong bạn đọc nhẫn nại!
Hiện nay hẳn các bạn sẽ bắt gặp rất nhiều trang web có chức năng sử dụng tài khoản facebook để đăng nhập, điều đó thuận tiện ở chỗ người dùng không phải mất cô">
<meta property="og:image" content="http://saysua.com/images/facebook-flow.png">
<meta property="og:image" content="http://saysua.com/images/facebook-new-app.png">
<meta property="og:image" content="http://saysua.com/images/facebook-app-info.png">
<meta property="og:image" content="http://saysua.com/images/facebook-login.png">
<meta property="og:image" content="http://saysua.com/images/facebook-auth.png">
<meta property="og:image" content="http://saysua.com/images/facebook-auth-info.png">
<meta property="og:updated_time" content="2016-10-16T01:43:18.940Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Viết chức năng login bằng tài khoản facebook không dùng Facebook SDK">
<meta name="twitter:description" content="Bài viết hơi dài, mong bạn đọc nhẫn nại!
Hiện nay hẳn các bạn sẽ bắt gặp rất nhiều trang web có chức năng sử dụng tài khoản facebook để đăng nhập, điều đó thuận tiện ở chỗ người dùng không phải mất cô">
<meta name="twitter:image" content="http://saysua.com/images/facebook-flow.png">
  
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42370265-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


   
  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
  #mc_embed_signup{clear:left; font:14px Helvetica,Arial,sans-serif; }
  #mc_embed_signup form {padding: 0px;}
  #mc_embed_signup .button {    background-color: #26C9FF;}
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
  
</head>
<body>
  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=166177166899797";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">
          <img class="author-avatar"/>
          <div class="text">Saysua Blog</div>
        </a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
          <nav id="main-nav">
  <a id="main-nav-toggle" class="nav-icon"></a>
  
    <a class="main-nav-link" href="/">Home</a>
  
    <a class="main-nav-link" href="http://app.saysua.com">Apps</a>
  
    <a class="main-nav-link" href="/about">About</a>
  
</nav>
          <div class="content">
            <article id="post-viet-chuc-nang-login-bang-tai-khoan-facebook-khong-dung-facebook-sdk" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/09/03/viet-chuc-nang-login-bang-tai-khoan-facebook-khong-dung-facebook-sdk/" class="article-date">
  <time datetime="2013-09-03T08:12:10.000Z" itemprop="datePublished">2013-09-03</time>
</a>
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Viết chức năng login bằng tài khoản facebook không dùng Facebook SDK
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Bài viết hơi dài, mong bạn đọc nhẫn nại!</p>
<p>Hiện nay hẳn các bạn sẽ bắt gặp rất nhiều trang web có chức năng sử dụng tài khoản facebook để đăng nhập, điều đó thuận tiện ở chỗ người dùng không phải mất công tạo tài khoản trên trang web mình mà vẫn có thể nhanh chóng đăng nhập để sử dụng các chức năng của thành viên.</p>
<p>Nếu bạn có ý định tích hợp chức năng đăng nhập bằng facebook cho website của mình mà không muốn sử dụng facebook SDK hoặc chỉ muốn tự mình viết để hiểu được cơ chế xác thực của facebook thì bài viết này sẽ hướng dẫn cho các bạn làm được điều đó <a id="more"></a> với minh họa bằng ngôn ngữ PHP.</p>
<p>Sau bài viết này, nếu nắm được các bước thực hiện các bạn hoàn toàn có thể áp dụng cho các tài khoản khác như google, hoặc sử dụng ngôn ngữ lập trình khác để làm điều tương tự.</p>
<p>Toàn bộ các bước thực hiện trong bài viết này được sử dụng thông tin hướng dẫn bởi facebook ở 2 địa chỉ sau:</p>
<ul>
<li><a href="https://developers.facebook.com/docs/facebook-login/getting-started-web/" target="_blank" rel="external">https://developers.facebook.com/docs/facebook-login/getting-started-web/</a></li>
<li><a href="https://developers.facebook.com/docs/facebook-login/login-flow-for-web-no-jssdk/" target="_blank" rel="external">https://developers.facebook.com/docs/facebook-login/login-flow-for-web-no-jssdk/</a></li>
</ul>
<h1 id="Quy-trinh-xac-thuc-bang-facebook"><a href="#Quy-trinh-xac-thuc-bang-facebook" class="headerlink" title="Quy trình xác thực bằng facebook"></a>Quy trình xác thực bằng facebook</h1><p>Để xác thực bằng facebook chúng ta sẽ trải qua 4 bước cơ bản như sau:</p>
<ul>
<li><p>Đầu tiên, từ trang web của mình, chúng ta yêu cầu người dùng cho phép truy cập vào thông tin của người dùng (Từ thông tin này ta sẽ dùng để đăng nhập vào hệ thống). Thực ra ở bước này ta sẽ chuyển hướng người dùng đến trang xác thực của facebook.</p>
</li>
<li><p>Tiếp theo, người dùng sẽ xác nhận và cung cấp cho ta các quyền để truy cập vào thông tin của người dùng.</p>
</li>
<li><p>Sau đó, facebook sẽ chuyển hướng người dùng về lại trang web của ta cùng với thông tin về quyền truy cập mà người dùng đã cho phép.</p>
</li>
<li><p>Từ thông tin facebook trả về, ta sẽ gọi các hàm API của facebook để lấy thông tin của người dùng như user name, email…</p>
</li>
<li><p>Với những thông tin đã có được, ta tiến hành đăng nhập cho người dùng ( chẳng hạn lưu vào session rằng người dùng đã đăng nhập), nếu muốn ta có thể sử dụng thông tin người dùng để lưu vào database.</p>
</li>
</ul>
<p>Tôi đã hệ thống các bước trên lại thành sơ đồ đơn giản như sau:</p>
<p><img src="/images/facebook-flow.png" alt="So do dang nhap facebook"></p>
<h1 id="Cung-viet-vai-doan-code"><a href="#Cung-viet-vai-doan-code" class="headerlink" title="Cùng viết vài đoạn code"></a>Cùng viết vài đoạn code</h1><p>Dưới đây tôi sẽ cố gắng trình bày thật chi tiết và dễ hiểu việc thực hiện sơ đồ trên với một ví dụ đăng nhập đơn giản, sử dụng ngôn ngữ PHP.</p>
<p>(Xin chú ý các bước dưới đây là các bước thực hiện chứ không có quan hệ song song với các bước ở sơ đồ trên)</p>
<h2 id="Buoc-1-Tao-mot-Facebook-App-va-Setting"><a href="#Buoc-1-Tao-mot-Facebook-App-va-Setting" class="headerlink" title="Bước 1: Tạo một Facebook App và Setting"></a>Bước 1: Tạo một Facebook App và Setting</h2><p>Trước tiên, ta cần tạo 1 app trong facebook và cài đặt nó để chạy trên môi trường localhost (vì ở đây tôi sẽ ví dụ chạy trên localhost, các bạn có thể sửa lại cài đặt cho phù hợp với môi trường riêng của mình)</p>
<p>Tạo 1 app mới tại <a href="https://developers.facebook.com/apps/" target="_blank" rel="external">Facebook App Dashboard</a> và điền các thông tin cơ bản</p>
<p><img src="/images/facebook-new-app.png" alt="Tao 1 app moi"></p>
<p>Sau đó, ta điền thêm các thông tin cấu hình cho app</p>
<p><img src="/images/facebook-app-info.png" alt="Dien thong tin fb app"></p>
<p>Ở hình trên ta thấy có 2 thông tin quan trọng là App ID và App secret sẽ được sử dụng trong code sau này.</p>
<h2 id="Buoc-2-Tao-trang-dang-nhap"><a href="#Buoc-2-Tao-trang-dang-nhap" class="headerlink" title="Bước 2: Tạo trang đăng nhập"></a>Bước 2: Tạo trang đăng nhập</h2><p>File: <code>index.php</code></p>
<p>Sau khi đã tạo xong app trên facbook, tiếp theo ta tạo trang đăng nhập cho website của mình. Để cho đơn giản, trang đăng nhập của tôi chỉ bao gồm 1 nút đăng nhập. Khi người dùng kích chuột vào đó, nó sẽ nhảy tới trang xác thực của facebook.</p>
<p><img src="/images/facebook-login.png" alt="Trang login"></p>
<p><img src="/images/facebook-auth.png" alt="Trang xac thuc facebook"></p>
<p>Code của trang index.php</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Facebook login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.facebook.com/dialog/oauth?client_id=YOUR_APP_ID&amp;redirect_uri=http://localhost/fblogin/callback.php"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ilovecuteshoes.com/skin/frontend/gravdept/acumen/img/facebook-login-button.png"</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Ở dòng 12, trong thẻ <code>&lt;a&gt;</code> ta có 2 tham số quan trọng:</p>
<p>client_id : đây là APP ID của app ta vừa tạo<br>redirect_uri : sau khi người dùng xác thực với facebook xong, facebook sẽ tự động điều hướng người dùng trở lại địa chỉ này. (tại đây ta sẽ xử lý các tham số được gởi về bởi facebook để lấy thông tin người dùng)</p>
<h2 id="Buoc-3-Tao-trang-xu-ly-khi-nguoi-dung-da-xac-thuc-bang-facebook"><a href="#Buoc-3-Tao-trang-xu-ly-khi-nguoi-dung-da-xac-thuc-bang-facebook" class="headerlink" title="Bước 3: Tạo trang xử lý khi người dùng đã xác thực bằng facebook"></a>Bước 3: Tạo trang xử lý khi người dùng đã xác thực bằng facebook</h2><p>File: <code>callback.php</code></p>
<p>Ở bước này ta thực hiện 3 bước nhỏ:</p>
<ul>
<li><p>Lấy access token từ giá trị trả về của facebook</p>
</li>
<li><p>Lấy thông tin người dùng từ access token có được</p>
</li>
<li><p>Login người dùng vào hệ thống</p>
</li>
</ul>
<p>Sau khi đã xác thực xong với facbook, người dùng sẽ được chuyển hướng về lại địa chỉ <a href="http://localhost/fblogin/callback.php" target="_blank" rel="external">http://localhost/fblogin/callback.php</a> . Khi chuyển hướng người dùng trở lại trang callback.php , facebook gởi thêm các thông tin xác thực của người dùng, từ đó ta có thể lấy được thông tin của người dùng vừa xác thực.</p>
<p>Cụ thể ở đây facebook điều hướng người dùng về địa chỉ của ta cùng với một tham số GET code  như url sau:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http:<span class="regexp">//</span>localhost<span class="regexp">/fblogin/</span>callback.php?code=AQDUeZ-…yBXVsc18<span class="comment">#_=_</span></div></pre></td></tr></table></figure>
<p>Từ giá trị của code  ta sẽ lấy ra được access token  để truy cập vào thông tin người dùng bằng cách gọi một HTTP GET request đến địa chỉ có dạng như sau:</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">GET https:<span class="comment">//graph.facebook.com/oauth/access_token?</span></div><div class="line">    client_id=&#123;app-id&#125;</div><div class="line">    <span class="variable">&amp;redirect_uri</span>=&#123;redirect-uri&#125;</div><div class="line">    <span class="variable">&amp;client_secret</span>=&#123;app-secret&#125;</div><div class="line">    <span class="variable">&amp;code</span>=&#123;code-parameter&#125;</div></pre></td></tr></table></figure>
<p>Nếu như thành công, ta sẽ nhận được kết quả trả về:</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml">access_token=</span><span class="template-variable">&#123;access-token&#125;</span><span class="xml">&amp;expires=</span><span class="template-variable">&#123;seconds-til-expiration&#125;</span><span class="xml"></span></div></pre></td></tr></table></figure>
<p>Dưới đây là đoạn code thực hiện các công việc trên:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line">    $app_id = <span class="string">""</span>;</div><div class="line">    $app_secret = <span class="string">""</span>;</div><div class="line">    $redirect_uri = urlencode(<span class="string">"http://localhost/fblogin/callback.php"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Get code value</span></div><div class="line">    $code = $_GET[<span class="string">'code'</span>];</div><div class="line"></div><div class="line">    <span class="comment">// Get access token info</span></div><div class="line">    $facebook_access_token_uri = <span class="string">"https://graph.facebook.com/oauth/access_token?client_id=$app_id&amp;redirect_uri=$redirect_uri&amp;client_secret=$app_secret&amp;code=$code"</span>;</div><div class="line">    $ch = curl_init();</div><div class="line">    curl_setopt($ch, CURLOPT_URL, $facebook_access_token_uri);</div><div class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</div><div class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">FALSE</span>);</div><div class="line"></div><div class="line">    $response = curl_exec($ch);</div><div class="line">    curl_close($ch);</div><div class="line"></div><div class="line">    <span class="comment">// Get access token</span></div><div class="line">    $access_token = str_replace(<span class="string">'access_token='</span>, <span class="string">''</span>, explode(<span class="string">"&amp;"</span>, $response)[<span class="number">0</span>]);</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>Để lấy được thông tin người dùng ta gọi đến Facebook Graph API sau:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http<span class="variable">s:</span>//graph.facebook.<span class="keyword">com</span>/<span class="keyword">me</span>?access_token=&#123;access_token&#125;</div></pre></td></tr></table></figure>
<p><img src="/images/facebook-auth-info.png" alt="Thong tin user"><br>Thông tin facebook user lấy bằng Graph API</p>
<p>Đoạn code lấy thông tin người dùng bằng Facebook Graph API</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//....</span></div><div class="line"></div><div class="line"><span class="comment">// Get user infomation</span></div><div class="line"><span class="meta"><span class="meta-keyword">$ch</span> = curl_init();</span></div><div class="line">curl_setopt(<span class="symbol">$</span>ch, CURLOPT_URL, <span class="string">"https://graph.facebook.com/me?access_token=$access_token"</span>);</div><div class="line">curl_setopt(<span class="symbol">$</span>ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</div><div class="line">curl_setopt(<span class="symbol">$</span>ch, CURLOPT_SSL_VERIFYPEER, FALSE);</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">$response</span> = curl_exec($ch);</span></div><div class="line">curl_close(<span class="symbol">$</span>ch);</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">$user</span> = json_decode($response);</span></div></pre></td></tr></table></figure>
<p>Cuối cùng, khi đã có thông tin user ta có thể tiến hành đăng nhập cho user bằng cách đơn giản lưu biến trong session, khi đó ở những trang khác ta có thể kiểm tra session để biết người dùng đã đăng nhập hay chưa.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Log user in</span></div><div class="line">$_SESSION[<span class="string">'user_login'</span>] = <span class="keyword">true</span>;</div><div class="line">$_SESSION[<span class="string">'user_name'</span>] = $user-&gt;username;</div><div class="line"></div><div class="line"><span class="keyword">echo</span> <span class="string">"Wellcome "</span>. $user-&gt;username .<span class="string">"!"</span>;</div></pre></td></tr></table></figure>
<p>Toàn bộ code đầy đủ file callback.php</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line">    session_start();</div><div class="line"></div><div class="line">    $app_id = <span class="string">""</span>;</div><div class="line">    $app_secret = <span class="string">""</span>;</div><div class="line">    $redirect_uri = urlencode(<span class="string">"http://localhost/fblogin/callback.php"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Get code value</span></div><div class="line">    $code = $_GET[<span class="string">'code'</span>];</div><div class="line"></div><div class="line">    <span class="comment">// Get access token info</span></div><div class="line">    $facebook_access_token_uri = <span class="string">"https://graph.facebook.com/oauth/access_token?client_id=$app_id&amp;redirect_uri=$redirect_uri&amp;client_secret=$app_secret&amp;code=$code"</span>;</div><div class="line"></div><div class="line">    $ch = curl_init();</div><div class="line">    curl_setopt($ch, CURLOPT_URL, $facebook_access_token_uri);</div><div class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</div><div class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">FALSE</span>);</div><div class="line"></div><div class="line">    $response = curl_exec($ch);</div><div class="line">    curl_close($ch);</div><div class="line"></div><div class="line">    <span class="comment">// Get access token</span></div><div class="line">    $access_token = str_replace(<span class="string">'access_token='</span>, <span class="string">''</span>, explode(<span class="string">"&amp;"</span>, $response)[<span class="number">0</span>]);</div><div class="line"></div><div class="line">    <span class="comment">// Get user infomation</span></div><div class="line">    $ch = curl_init();</div><div class="line">    curl_setopt($ch, CURLOPT_URL, <span class="string">"https://graph.facebook.com/me?access_token=$access_token"</span>);</div><div class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</div><div class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">FALSE</span>);</div><div class="line"></div><div class="line">    $response = curl_exec($ch);</div><div class="line">    curl_close($ch);</div><div class="line"></div><div class="line">    $user = json_decode($response);</div><div class="line"></div><div class="line">    <span class="comment">// Log user in</span></div><div class="line">    $_SESSION[<span class="string">'user_login'</span>] = <span class="keyword">true</span>;</div><div class="line">    $_SESSION[<span class="string">'user_name'</span>] = $user-&gt;username;</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> <span class="string">"Wellcome "</span>. $user-&gt;username .<span class="string">"!"</span>;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Buoc-4-Luu-thong-tin-nguoi-dung-neu-muon"><a href="#Buoc-4-Luu-thong-tin-nguoi-dung-neu-muon" class="headerlink" title="Bước 4: Lưu thông tin người dùng nếu muốn"></a>Bước 4: Lưu thông tin người dùng nếu muốn</h2><p>Ở bước 3, sau khi đã lấy thông tin người dùng, các bạn có thể lưu người dùng vào database, hoặc kiểm tra người dùng đã có trên hệ thống chưa … Thông tin bây giờ là của bạn, các bạn có thể làm bất cứ điều gì mình muốn.</p>
<p>Hy vọng, với những bước đơn giản ở trên, các bạn có thể tự nắm được cách xác thực của facebook để lấy thông tin người dùng, hoặc bằng một vài thay đổi nhỏ ở bước 1, các bạn hoàn toàn có thể yêu cầu người dùng cung cấp quyền post bài viết, upload ảnh … các bạn nên đọc thêm ở 2 link mình đã dẫn ra ở trên để có thể làm được điều này.</p>
<p>Ngoài ra, mình mong rằng với cách xác thực bằng facebook ở trên, các bạn cũng có thể tự mình viết được những đoạn mã xác thực cho các mạng xã hội khác như google, twitter…</p>
<p>Chúc các bạn một ngày vui vẻ sau khi đã đọc xong bài viết hơi dài này. Nếu có bất cứ phản hồi hoặc thắc mắc nào các bạn có thể thoải mái viết vào phần comment. :)</p>
<h1 id="All-source-code"><a href="#All-source-code" class="headerlink" title="All source code"></a>All source code</h1><p>Tất cả source code của bài viết các bạn có thể lấy về từ đây: <a href="https://github.com/thachnuida/fblogin" target="_blank" rel="external">https://github.com/thachnuida/fblogin</a></p>
<blockquote><p>Update 19/12/2013: Parse error: syntax error, unexpected ‘[‘ in /…/callback.php on line 23</p>
</blockquote>
<p>Mình đã cập nhật lại code, lỗi này xảy ra do việc xử lý mảng giữa các phiên bản PHP bị khác nhau.</p>
<p>Bên cạnh đó các bạn có thể chạy thử demo tại đây: <a href="http://saysua.com/demo/fblogin">http://saysua.com/demo/fblogin</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://saysua.com/2013/09/03/viet-chuc-nang-login-bang-tai-khoan-facebook-khong-dung-facebook-sdk/" data-id="civomsm1400144ovlegj5ng2d" class="article-share-link">Share</a>
      
        <a href="http://saysua.com/2013/09/03/viet-chuc-nang-login-bang-tai-khoan-facebook-khong-dung-facebook-sdk/#disqus_thread" class="article-comment-link">Comments</a>
      
      <div class="tagcloud">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Facebook/">Facebook</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OAuth/">OAuth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>

      </div>
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/09/09/javascript-hoisting-la-cai-gi/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Javascript Hoisting là gì?
        
      </div>
    </a>
  
  
    <a href="/2013/08/28/js-tim-hieu-ve-callback-trong-javascript/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Tìm hiểu về Callback trong JavaScript</div>
    </a>
  
</nav>

  
</article>

<hr>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


          </div>
        </section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">Like my blog?</h3>
    <div class="widget">
        <div id="mc_embed_signup">
            <form action="//saysua.us13.list-manage.com/subscribe/post?u=f73e6f67cd2f017d41a3e3d41&amp;id=f866d9a20e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="novalidate">
                <div id="mc_embed_signup_scroll">
            <div class="mc-field-group">
                <label>Enter your email to subscribe my blog.</label>
                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Your email address" aria-required="true">
            </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f73e6f67cd2f017d41a3e3d41_f866d9a20e" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </div>
            </form>
        </div>
    </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Labels</h3>
    <div class="widget tagcloud">
      <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Angular2/" style="font-size: 18px;">Angular2</a> <a href="/tags/Angularjs/" style="font-size: 12px;">Angularjs</a> <a href="/tags/Bower/" style="font-size: 12px;">Bower</a> <a href="/tags/Facebook/" style="font-size: 12px;">Facebook</a> <a href="/tags/Godaddy/" style="font-size: 12px;">Godaddy</a> <a href="/tags/Gulp/" style="font-size: 12px;">Gulp</a> <a href="/tags/Javascript/" style="font-size: 20px;">Javascript</a> <a href="/tags/Jquery/" style="font-size: 18px;">Jquery</a> <a href="/tags/Machine-Learning/" style="font-size: 16px;">Machine Learning</a> <a href="/tags/Mysql/" style="font-size: 12px;">Mysql</a> <a href="/tags/NodeJs/" style="font-size: 12px;">NodeJs</a> <a href="/tags/Nodejs/" style="font-size: 16px;">Nodejs</a> <a href="/tags/Nvm/" style="font-size: 12px;">Nvm</a> <a href="/tags/OAuth/" style="font-size: 12px;">OAuth</a> <a href="/tags/PHP/" style="font-size: 14px;">PHP</a> <a href="/tags/Python/" style="font-size: 12px;">Python</a> <a href="/tags/Scrape/" style="font-size: 12px;">Scrape</a> <a href="/tags/TeamCity/" style="font-size: 12px;">TeamCity</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/25/toi-hoc-machine-learning-003-supervised-learning-hoc-co-giam-sat/">Tôi học Machine Learning - 003 - Supervised Learning - Học có giám sát</a>
          </li>
        
          <li>
            <a href="/2016/11/23/toi-hoc-machine-learning-002/">Tôi học Machine Learning - 002 - Khóa học trên Coursera</a>
          </li>
        
          <li>
            <a href="/2016/11/18/toi-hoc-machine-learning-001-nhap-mon/">Tôi học Machine Learning - 001 - Nhập môn</a>
          </li>
        
          <li>
            <a href="/2016/10/18/cai-dat-nodejs-tren-godaddy-shared-hosting/">Cài đặt Nodejs trên Godaddy shared hosting</a>
          </li>
        
          <li>
            <a href="/2016/09/07/teamcity-build-agent-disconnected/">TeamCity – Build agent disconnected</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Thach Nguyen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      Theme is based on <a href="http://demo.s5themes.com/focused/">Focused</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="http://app.saysua.com" class="mobile-nav-link">Apps</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'saysua';
  
  var disqus_url = 'http://saysua.com/2013/09/03/viet-chuc-nang-login-bang-tai-khoan-facebook-khong-dung-facebook-sdk/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>