<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Xử lý hình ảnh hiển thị sai hướng bằng cách xác định giá trị EXIF orientation | Saysua Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Trong thời gian này mình có làm một ứng dụng chat, trong đó có tính năng upload file và hình ảnh. Và mình đã gặp một vấn đề với các hình ảnh được chụp bằng điện thoại. Đó là hình ảnh bị hiển thị sai h">
<meta property="og:type" content="article">
<meta property="og:title" content="Xử lý hình ảnh hiển thị sai hướng bằng cách xác định giá trị EXIF orientation">
<meta property="og:url" content="http://saysua.com/2015/08/06/xu-ly-hinh-anh-hien-thi-sai-huong-voi-exif-orientation/index.html">
<meta property="og:site_name" content="Saysua Blog">
<meta property="og:description" content="Trong thời gian này mình có làm một ứng dụng chat, trong đó có tính năng upload file và hình ảnh. Và mình đã gặp một vấn đề với các hình ảnh được chụp bằng điện thoại. Đó là hình ảnh bị hiển thị sai h">
<meta property="og:image" content="http://saysua.com/images/orientation-6.jpg">
<meta property="og:image" content="http://saysua.com/images/EXIF_Orientations.gif">
<meta property="og:updated_time" content="2016-10-16T01:44:01.701Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xử lý hình ảnh hiển thị sai hướng bằng cách xác định giá trị EXIF orientation">
<meta name="twitter:description" content="Trong thời gian này mình có làm một ứng dụng chat, trong đó có tính năng upload file và hình ảnh. Và mình đã gặp một vấn đề với các hình ảnh được chụp bằng điện thoại. Đó là hình ảnh bị hiển thị sai h">
<meta name="twitter:image" content="http://saysua.com/images/orientation-6.jpg">
  
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42370265-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


   
  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
  #mc_embed_signup{clear:left; font:14px Helvetica,Arial,sans-serif; }
  #mc_embed_signup form {padding: 0px;}
  #mc_embed_signup .button {    background-color: #26C9FF;}
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
  
</head>
<body>
  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=166177166899797";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">
          <img class="author-avatar"/>
          <div class="text">Saysua Blog</div>
        </a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
          <nav id="main-nav">
  <a id="main-nav-toggle" class="nav-icon"></a>
  
    <a class="main-nav-link" href="/">Home</a>
  
    <a class="main-nav-link" href="http://app.saysua.com">Apps</a>
  
    <a class="main-nav-link" href="/about">About</a>
  
</nav>
          <div class="content">
            <article id="post-xu-ly-hinh-anh-hien-thi-sai-huong-voi-exif-orientation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/06/xu-ly-hinh-anh-hien-thi-sai-huong-voi-exif-orientation/" class="article-date">
  <time datetime="2015-08-06T03:13:37.000Z" itemprop="datePublished">2015-08-06</time>
</a>
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Xử lý hình ảnh hiển thị sai hướng bằng cách xác định giá trị EXIF orientation
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Trong thời gian này mình có làm một ứng dụng chat, trong đó có tính năng upload file và hình ảnh. Và mình đã gặp một vấn đề với các hình ảnh được chụp bằng điện thoại. Đó là hình ảnh bị hiển thị sai hướng, do khi chụp người dùng đã để dọc điện thoại, dẫn đến lúc hiển thị hình ảnh trên trang web, thay vì hình ảnh hiển thị thẳng đứng thì lại nằm ngang. Giống như thế này:</p>
<p><img src="/images/orientation-6.jpg" alt="Orientation 6"></p>
<p>Và công việc của mình là phải xác định được, hình ảnh đó bị sai thế nào, để hiển thị lại cho đúng.</p>
<a id="more"></a>
<p>Để làm được việc này, trước tiên mình cần phải xác định được một thuộc tính của hình ảnh mà qua đó mình biết được hình ảnh đó đang bị quay theo hướng nào. Sau một hồi tìm kiếm, mình đã phát hiện ra thuộc tính <code>EXIF:orientation</code> sẽ cho ta biết được điều này:</p>
<p><code>EXIF</code>: Exchangeable image file format (đây là một chuẩn để lưu giữ các thông tin thông số của ảnh như chế độ flash, ngày tạo, ống kính thế nào. Các bạn có thể coi ở đây chi tiết các thông số nó có thể lưu <a href="http://forum.vietdesigner.net/threads/thuat-ngu-exif-anh-anh-viet.27870/" target="_blank" rel="external">http://forum.vietdesigner.net/threads/thuat-ngu-exif-anh-anh-viet.27870/</a>)</p>
<p>Tất nhiên là mình không cần phải biết hết các thông số này, ở đây có một thông số đặc biệt mình cần dùng đó là <code>orientation</code> thông số cho biết hướng của ảnh.</p>
<p>Hình vẽ dưới đây sẽ cho các bạn biết được các giá trị của orientation và ví dụ:</p>
<p><img src="/images/EXIF_Orientations.gif" alt="Orientation 6"><br>(Hình ảnh được lấy từ <a href="http://www.daveperrett.com/articles/2012/07/28/exif-orientation-handling-is-a-ghetto/" target="_blank" rel="external">http://www.daveperrett.com/articles/2012/07/28/exif-orientation-handling-is-a-ghetto/</a>)</p>
<p>Như hình vẽ, ta thấy nếu orientation là 6, nghĩa là hình ảnh đã bị xoay sang trái 90 độ). Vậy là chỉ cần lấy được giá trị EXIF:orientation là xong. Lúc này mình sẽ cần đến thư viện <code>exif-js</code> (<a href="https://github.com/exif-js/exif-js" target="_blank" rel="external">https://github.com/exif-js/exif-js</a>) để lấy giá trị orientation:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;img id=<span class="string">"test-img"</span> src=<span class="string">"url/of/image"</span> /&gt;</div><div class="line"></div><div class="line"><span class="keyword">var</span> element = $(<span class="string">'#test-img'</span>);</div><div class="line"></div><div class="line">element.bind(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  EXIF.getData(element[<span class="number">0</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> orientation = EXIF.getTag(element[<span class="number">0</span>], <span class="string">'Orientation'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Sau khi đã có được orientation, ta dựa vào từng giá trị tương ứng để xoay ảnh lại cho thích hợp, ở đây mình sử dụng thuộc tính <code>transform</code> của css để xoay ảnh:</p>
<p>Ví dụ với orientation là 6 mình sẽ xoay ảnh thế này:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">function</span> <span class="selector-tag">setTransform</span>(transform) &#123;</div><div class="line">  <span class="selector-tag">element</span><span class="selector-class">.css</span>(<span class="string">'-ms-transform'</span>, transform);</div><div class="line">  <span class="selector-tag">element</span><span class="selector-class">.css</span>(<span class="string">'-webkit-transform'</span>, transform);</div><div class="line">  <span class="selector-tag">element</span><span class="selector-class">.css</span>(<span class="string">'-moz-transform'</span>, transform);</div><div class="line">  <span class="selector-tag">element</span><span class="selector-class">.css</span>(<span class="string">'transform'</span>, transform);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">setTransform</span>(<span class="string">'rotate(90deg)'</span>);</div></pre></td></tr></table></figure>
<p>Làm tương tự với các giá trị orientation khác là coi như giải quyết được vấn đề. Trong vấn đề thực của mình gặp phải, mình đã viết 1 directive của Angularjs để xử lý, các bạn có thể coi ở đây: <a href="https://gist.github.com/thachnuida/2f76fe3aaa15dbd1dfa3" target="_blank" rel="external">https://gist.github.com/thachnuida/2f76fe3aaa15dbd1dfa3</a></p>
<p>Ngoài ra, mình thấy hiện tại bên trình duyệt firefox đang hỗ trợ một thuộc tính <code>image-orientation</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/image-orientation" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/CSS/image-orientation</a>) nhưng mà cũng chỉ có duy nhất mỗi nó đang hỗ trợ, nên có lẽ cần đợi thêm thời giãn xem sao.</p>
<p>Hoặc là cũng có một cách sử dụng thư viện load image để load hình ảnh vào canvas như ở đây <a href="http://stackoverflow.com/questions/20600800/js-client-side-exif-orientation-rotate-and-mirror-jpeg-images" target="_blank" rel="external">http://stackoverflow.com/questions/20600800/js-client-side-exif-orientation-rotate-and-mirror-jpeg-images</a></p>
<p>Cách giải quyết của mình ở đây là chỉ ở phía client, còn khi mình upload lên server thì mình có sử dung thư viện để sửa lại hình ảnh cho đúng rồi. :D Hy vọng bài viết này mang lại cho các bạn một chút thú vị trong ngày.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://saysua.com/2015/08/06/xu-ly-hinh-anh-hien-thi-sai-huong-voi-exif-orientation/" data-id="ciwkxg378001lk0vlqlahzllu" class="article-share-link">Share</a>
      
        <a href="http://saysua.com/2015/08/06/xu-ly-hinh-anh-hien-thi-sai-huong-voi-exif-orientation/#disqus_thread" class="article-comment-link">Comments</a>
      
      <div class="tagcloud">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

      </div>
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/08/27/tam-biet-wordpress-xin-chao-hexo/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Tạm biệt wordpress xin chào hexo
        
      </div>
    </a>
  
  
    <a href="/2014/10/11/khoi-tao-du-an-angularjs-voi-generator-boom/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Khởi tạo dự án AngularJS với generator-boom</div>
    </a>
  
</nav>

  
</article>

<hr>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


          </div>
        </section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">Like my blog?</h3>
    <div class="widget">
        <div id="mc_embed_signup">
            <form action="//saysua.us13.list-manage.com/subscribe/post?u=f73e6f67cd2f017d41a3e3d41&amp;id=f866d9a20e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="novalidate">
                <div id="mc_embed_signup_scroll">
            <div class="mc-field-group">
                <label>Enter your email to subscribe my blog.</label>
                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Your email address" aria-required="true">
            </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f73e6f67cd2f017d41a3e3d41_f866d9a20e" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </div>
            </form>
        </div>
    </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Labels</h3>
    <div class="widget tagcloud">
      <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Angular2/" style="font-size: 18px;">Angular2</a> <a href="/tags/Angularjs/" style="font-size: 12px;">Angularjs</a> <a href="/tags/Bower/" style="font-size: 12px;">Bower</a> <a href="/tags/Elastic-search/" style="font-size: 12px;">Elastic search</a> <a href="/tags/Facebook/" style="font-size: 12px;">Facebook</a> <a href="/tags/Godaddy/" style="font-size: 12px;">Godaddy</a> <a href="/tags/Gulp/" style="font-size: 12px;">Gulp</a> <a href="/tags/Javascript/" style="font-size: 20px;">Javascript</a> <a href="/tags/Jquery/" style="font-size: 18px;">Jquery</a> <a href="/tags/Life/" style="font-size: 12px;">Life</a> <a href="/tags/Logstash/" style="font-size: 12px;">Logstash</a> <a href="/tags/Machine-Learning/" style="font-size: 18px;">Machine Learning</a> <a href="/tags/Mysql/" style="font-size: 12px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 12px;">Nginx</a> <a href="/tags/NodeJs/" style="font-size: 12px;">NodeJs</a> <a href="/tags/Nodejs/" style="font-size: 16px;">Nodejs</a> <a href="/tags/Nvm/" style="font-size: 12px;">Nvm</a> <a href="/tags/OAuth/" style="font-size: 12px;">OAuth</a> <a href="/tags/PHP/" style="font-size: 14px;">PHP</a> <a href="/tags/Python/" style="font-size: 12px;">Python</a> <a href="/tags/Scrape/" style="font-size: 12px;">Scrape</a> <a href="/tags/TeamCity/" style="font-size: 12px;">TeamCity</a> <a href="/tags/Visual-Studio/" style="font-size: 12px;">Visual Studio</a>
    </div>
  </div>

  
    <div class="widget-wrap">
<h3 class="widget-title">Ads</h3>
<div class="widget">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- saysua-sidebar-responsive -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-4997068093676921"
         data-ad-slot="9242989898"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/08/ky-luat-la-tu-do/">Kỷ luật là tự do</a>
          </li>
        
          <li>
            <a href="/2016/12/17/nhung-chuc-nang-moi-cua-es6/">Những chức năng mới của ES6</a>
          </li>
        
          <li>
            <a href="/2016/12/04/push-nginx-log-to-elasticsearch-by-using-logstash/">Lưu log của nginx vào elastic search bằng logstash</a>
          </li>
        
          <li>
            <a href="/2016/12/01/chay-visual-studio-solution-tu-command-line/">Chạy Visual Studio Solution từ command line</a>
          </li>
        
          <li>
            <a href="/2016/11/26/toi-hoc-machine-learning-004-unsupervised-learning-hoc-khong-co-giam-sat/">Tôi học Machine Learning - 004 - Unsupervised Learning - Học không có giám sát</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Thach Nguyen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      Theme is based on <a href="http://demo.s5themes.com/focused/">Focused</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="http://app.saysua.com" class="mobile-nav-link">Apps</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'saysua';
  
  var disqus_url = 'http://saysua.com/2015/08/06/xu-ly-hinh-anh-hien-thi-sai-huong-voi-exif-orientation/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>